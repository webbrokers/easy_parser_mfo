/**
 * Сервис для сопоставления разных названий офферов в единый бренд.
 */

const BRAND_ALIASES = {
    'еКапуста': ["ekapusta","e-kapusta","e kapusta","екапуста","е-капуста","е капуста"],
    'Манимен': ["moneyman","money-man","money man","манимен","мани-мен","мани мен"],
    'Займер': ["zaymer","robot-zaymer","robot zaymer","займер","робот займер"],
    'Лайм-Займ': ["limezaim","lime-zaim","lime zaim","лаймзайм","лайм-займ","лайм займ"],
    'Монеза': ["moneza","монеза"],
    'Турбозайм': ["turbozaim","turbo-zaim","turbo займ","турбозайм","турбо-займ","турбо займ"],
    'CreditPlus': ["creditplus","credit-plus","credit plus","кредитплюс","кредит-плюс","кредит плюс"],
    'Платиза': ["platiza","платиза"],
    'Pay P.S.': ["payps","pay-ps","pay ps","pay p.s.","пейпс","пей-пс","пей пс"],
    'Езаем': ["ezaem","e-zaem","e zaem","езайм","е-займ","е займ","езаем"],
    'Kredito24': ["kredito24","кредито24"],
    'СмартКредит': ["smartcredit","smart-credit","smart credit","смарткредит","смарт-кредит","смарт кредит"],
    'МигКредит': ["migcredit","mig-credit","mig credit","мигкредит","миг-кредит","миг кредит"],
    'Честное слово': ["4slovo","честное слово","честное-слово"],
    'Отличные Наличные': ["otlnal","отличные наличные","отличные-наличные"],
    'Срочноденьги': ["srochnodengi","srochno-dengi","srochno деньги","срочноденьги","срочно-деньги","срочно деньги"],
    'Деньги Сразу': ["dengisrazy","dengi-srazy","деньги сразу","деньгисразу","деньги-сразу"],
    'Быстроденьги': ["bistrodengi","bistro-dengi","быстроденьги","быстро-деньги"],
    'Вэббанкир': ["webbankir","web-bankir","web bankir","вэббанкир","вэб-банкир","вэб банкир"],
    'Главфинанс': ["glavfinans","главфинанс"],
    'До Зарплаты': ["dozarplati","do-zarplati","до зарплаты","до-зарплаты"],
    'Джой Мани': ["joymoney","joy-money","joy money","джоймани","джой-мани","джой мани"],
    'Конга': ["konga","конга"],
    'OneClickMoney': ["oneclickmoney","one-click-money","one click money","ван клик мани"],
    'ГринМани': ["greenmoney","green-money","green money","гринмани","грин-мани","грин мани"],
    'Вивус': ["vivus","вивус"],
    'СМСФинанс': ["smsfinance","sms-finance","смсфинанс","смс-финанс"],
    'Займиго': ["zaymigo","займиго"],
    'Микроклад': ["microklad","микроклад"],
    'Центрофинанс': ["centrofinans","centro-finans","центрофинанс"],
    'Веб-Займ': ["web-zaim","web zaim","вебзайм","веб-займ","веб займ"],
    'Финтерра': ["finterra","финтерра"],
    'VIVA Деньги': ["vivadengi","viva-dengi","viva деньги","виваденьги","вива-деньги","вива деньги"],
    'ДоброЗайм': ["centrzaimov","dobrozaim","доброзайм","центр займов"],
    'Хот-Займ': ["hot-zaim","hot zaim","хотзайм","хот-займ","хот займ"],
    'Фастмани': ["fastmoney","fast-money","fast money","фастмани","фаст-мани","фаст мани"],
    'Биг-Займ': ["big-zaim","big zaim","бигзайм","биг-займ","биг займ"],
    'Деньги на дом': ["denginadom","dengi-na-dom","деньги на дом","деньгинадом","деньги-на-дом"],
    'Али Займ': ["alizaim","alizaym","али займ","ализайм"],
    'CashToYou': ["cashtoyou","кеш ту ю"],
    'Квику': ["kviku","квику"],
    'Евро Экспресс Кредит': ["europexpresscredit","евро экспресс кредит"],
    'Здесь Легко': ["zdeslegko-auto","здесь легко"],
    'Кредит Стар': ["creditstar","кредит стар","кредитстар"],
    'НарКредит': ["narcredit","наркредит"],
    'Макс-Кредит': ["maxcredit","макс-кредит","макс кредит"],
    'Кар Капитал': ["carcapital24","кар капитал"],
    'Надо Денег': ["nadodeneg","надо денег","надоденег"],
    'Белка Кредит': ["belkacredit","белка кредит","белкакредит"],
    'Робокредит': ["robocredit","робокредит"],
    'Займ Экспресс': ["zaymexpress","займ экспресс","займэкспресс"],
    'CarMoney': ["carmoney","кармани","кар мани"],
    'Кэшпоинт': ["cashpoint","кэшпоинт"],
    'Содействие': ["sodejstvie","содействие"],
    'АФГ Финанс': ["afgfin","афг финанс"],
    'Желдорзайм': ["zheldorzaim","желдорзайм"],
    'Фанмани': ["fanmoney","фанмани"],
    'Финмолл': ["finmoll","финмолл"],
    'Деньга': ["denga","деньга"],
    'Cashdrive': ["cashdrive","кешдрайв"],
    'Папа Финанс': ["papafinance","папа финанс"],
    'Займи РФ': ["zaymirf","займи рф"],
    'Манифактура': ["moneyfaktura","манифактура"],
    'Умные Наличные': ["smartcash","умные наличные"],
    'Наличные': ["nalichnienalichnie","наличные"],
    'СмартСтарт': ["smartstart24","смартстарт"],
    'Честный Займ': ["chestnii-zaim","честный займ"],
    'Каранга': ["caranga","каранга"],
    'Бустра': ["boostra","бустра"],
    'Честный Ноль': ["chestnyj-nol","честный ноль"],
    'Mscore': ["mscore","медиумскор"],
    'Небус': ["nebusfinance","небус"],
    'Budgett': ["budgett","баджетт"],
    'АДеньги': ["adengi","аденьги"],
    'Целевые Финансы': ["celfinansi","целевые финансы"],
    'ВД Платинум': ["vdplatinum","вд платинум"],
    'Микрозайм': ["microzaim","микрозайм"],
    'Мир Кэш': ["mircash24","мир кэш"],
    'Кредиска': ["krediska","кредиска"],
    'Бери Беру': ["beriberu","бери беру"],
    'ДеньгиМигом': ["dengimigom","деньгимигом"],
    'МФО Банк': ["mfobank","мфо банк"],
    'Свои Люди': ["svoiludi","свои люди"],
    '495 Кредит': ["495credit","495 кредит"],
    'Финфайв': ["finfive","финфайв"],
    'Экспрессденьги': ["jekspressdengi","экспрессденьги"],
    'Привет Сосед': ["privet-sosed","привет сосед"],
    'Beeon': ["beeon","бион"],
    'СКБ Финанс': ["skbfinance","скб финанс"],
    'Creddy': ["creddy","кредди"],
    'Юкки': ["ykky","юкки"],
    'ЕРЦК': ["erck","ерцк"],
    'Корона': ["korona","корона"],
    'Илма': ["ilma","илма"],
    'Займи Руб': ["zaimirub","займи руб"],
    'Простой вопрос': ["prostoy vopros","простой вопрос"],
    'Капиталина': ["capitalina","капиталина"],
    'Папа Займ': ["papa-zaim","папа займ"],
    'Банкомато': ["bankomato","банкомато"],
    'Скела Мани': ["skelamoney","скела мани"],
    'Хурма Кредит': ["hurmacredit","хурма кредит"],
    'Акадо': ["acado","акадо"],
    'ЛайкЗайм': ["likezaim67","лайкзайм"],
    'Белые Деньги': ["beliedengi","белые деньги"],
    'Твои Займы': ["tvoizaymy","твои займы"],
    'Банка Денег': ["bankadeneg","банка денег"],
    'Ваш инвестор': ["vashinvestor","ваш инвестор"],
    'Ясень': ["yasen","ясень"],
    'Колибри Деньги': ["colibridengi","колибри деньги"],
    'Кредит Смайл': ["creditsmile","кредит смайл"],
    'У Абрамовича': ["uabramovicha","у абрамовича"],
    'Космизайм': ["kosmiczaym","космизайм"],
    'Мистер Кэш': ["mrcash","мистер кэш"],
    'Займ Мобайл': ["zaimmobile","займ мобайл"],
    'Финтерс': ["finters","финтерс"],
    'Заем.ру': ["zaemru","заем.ру"],
    'Мигомзайм': ["migomzaim","мигомзайм"],
    'Бро22': ["bro22","бро22"],
    'Страна Экспресс': ["stranaexpress","страна экспресс"],
    'РокетМэн': ["rocketman","рокетмэн"],
    'Давака': ["davaka","давака"],
    'Кредит2дей': ["credit2day","кредит2дей"],
    'Кэширо': ["cashiro","кэширо"],
    'Тез Финанс': ["tezfinance","тез финанс"],
    'Смарт Займ': ["smartzaym-pts","смарт займ"],
    'Драйв Займ': ["drivezaim-pts","драйв займ"],
    'Кэшмагнит': ["cashmagnit","кэшмагнит"],
    'Пробаланс': ["probalance","пробаланс"],
    'Мир Займов': ["mirzaimov","мир займов"],
    'Деньги ОК': ["dengiok","деньги ок"],
    'Экзайм': ["eqzaim","экзайм"],
    'Кекас': ["kekas","кекас"],
    'Кредит 365': ["credit365","кредит 365"],
    'Скорзайм': ["skorzaym","скорзайм"],
    'МегаДеньги': ["megadengi","мегаденьги"],
    'Кит Кредит': ["kitcredit","кит кредит"],
    'Экозайм': ["ecozaym","экозайм"],
    'Снап Кредит': ["snapcredit","снап кредит"],
    'Дополучкино': ["dopoluchkino","дополучкино"],
    'Фри Капитал': ["freecapital","фри капитал"],
    'Лайк Мани': ["likemoney","лайк мани"],
    'Возьмика': ["vozmika","возьмика"],
};

class NormalizationService {
    static BRAND_ALIASES = BRAND_ALIASES;

    /**
     * Превращает любое название в эталонное имя бренда.
     */
    static normalize(name, url = '') {
        if (!name) return 'Unknown';

        let cleanName = name.toLowerCase()
            .replace(/['"«»]/g, '')
            .replace(/(мфо|мкк|ооо|зао|пао|мфк)/gi, '')
            .trim();

        // 1. Проверяем по справочнику алиасов
        for (const [brand, aliases] of Object.entries(BRAND_ALIASES)) {
            if (aliases.some(a => cleanName.includes(a.toLowerCase()))) {
                return brand;
            }
        }

        // 2. Если в имени нет зацепок, проверяем URL
        if (url) {
            const lowUrl = url.toLowerCase();
            for (const [brand, aliases] of Object.entries(BRAND_ALIASES)) {
                if (aliases.some(a => lowUrl.includes(a.toLowerCase()))) {
                    return brand;
                }
            }
        }

        // 3. Если ничего не подошло, возвращаем причесанное исходное имя
        return name.split(/[.,!?;|]/)[0].trim().substring(0, 30);
    }
}

module.exports = { NormalizationService, BRAND_ALIASES };
